configfile: "config.yaml"

def pair_name_to_infiles():
    pass
    # follow the following stackoverflow question
    # https://stackoverflow.com/questions/50413374/glob-wildcards-on-multiple-directories-with-different-file-names


FAST5_FILES, = glob_wildcards(config['results_folder'] + "DataFiles/fast5/{fast5_files}.fast5")
BARCODE, = expand(glob_wildcards(config['results_folder'] + "Basecall/{fast5_folder}/{{fastq_file}}.fastq"), fast5_folder=FAST5_FILES)


rule all:
    input:
        expand(config['results_folder'] + "Basecall/{fast5_files}", fast5_files=FAST5_FILES),


rule basecall:
    input:
         config['results_folder'] + "DataFiles/fast5/{fast5_files}.fast5"
    output:
        directory(config['results_folder'] + "Basecall/{fast5_files}")
    shell:
        "ls {input}"
        
        " | "
        
        "guppy_basecaller "
        "--quiet "
        "--save_path {output} "
        "--config dna_r9.4.1_450bps_fast.cfg "
        "--num_callers 2 "
        "--cpu_threads_per_caller 6 "

rule barcode:
    input:
        expand(config['results_folder'] + "Basecall/{fast5_folder}/{fastq_file}", fast5_folder=FAST5_FILES)
    output:
        temp(directory(config['results_folder'] + "Barocde/{fast5_folder}"))
    shell:
        "guppy_barcoder "
        "--input_path {input} "
        "--save_path {output} "
        "--barcode_kits EXP-PBC096 "
        "--recursive "
        "--quiet"
